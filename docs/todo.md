# TODO: План создания структуры /data_rework/

## 1. Подготовка списка источников

- [ ] Извлечь полный список кодов источников (source) из books.html
- [ ] Составить маппинг: код источника → полное название книги
- [ ] Примеры источников: PHB, XPHB, DMG, MM, XGE, TCE, FTD и т.д.

## 2. Создание структуры папок

### 2.1. Корневая структура
- [ ] Создать папку `/data_rework/`
- [ ] Для каждого источника создать подпапку `/data_rework/[SOURCE]/`
  - Пример: `/data_rework/PHB/`
  - Пример: `/data_rework/XPHB/`
  - Пример: `/data_rework/DMG/`

### 2.2. Вложенные папки для каждого источника
- [ ] Создать `/data_rework/[SOURCE]/img/` — для изображений источника
- [ ] Создать `/data_rework/[SOURCE]/pdf/` — для PDF-файлов источника (если есть)

## 3. Разделение JSON-файлов по источникам

### 3.1. Обработка каждого JSON из /data
- [ ] Прочитать исходный файл (например, `/data/actions.json`)
- [ ] Найти все объекты с полем `source`
- [ ] Сгруппировать объекты по значению `source`
- [ ] Создать отдельный JSON для каждого источника:
  - Объект с `"source": "PHB"` → `/data_rework/PHB/actions.json`
  - Объект с `"source": "XPHB"` → `/data_rework/XPHB/actions.json`

### 3.2. Список JSON-файлов для обработки
- [ ] actions.json
- [ ] backgrounds.json
- [ ] bestiary/ (все файлы монстров)
- [ ] class/ (все файлы классов)
- [ ] feats.json
- [ ] items.json
- [ ] optionalfeatures.json
- [ ] races.json
- [ ] spells/ (все файлы заклинаний)
- [ ] ... (все остальные JSON в /data)

## 4. Копирование изображений в /data_rework/[SOURCE]/img/

### 4.1. Определение связи изображений с источниками
- [ ] Проанализировать ссылки на изображения внутри JSON (поля с путями к /img)
- [ ] Определить source объекта, содержащего ссылку на изображение
- [ ] Сопоставить изображение с источником

### 4.2. Копирование файлов
- [ ] Для каждого изображения определить целевую папку по source
- [ ] Скопировать изображение в `/data_rework/[SOURCE]/img/`
- [ ] Сохранить оригинальную структуру подпапок внутри img (если нужно)

## 5. Копирование PDF-файлов в /data_rework/[SOURCE]/pdf/

### 5.1. Поиск и идентификация PDF
- [ ] Найти все PDF-файлы в репозитории
- [ ] Определить source каждого PDF по имени файла или содержимому

### 5.2. Копирование файлов
- [ ] Скопировать каждый PDF в соответствующую папку `/data_rework/[SOURCE]/pdf/`

## 6. Обработка тегов и ссылок в JSON

- [ ] Определить стратегию для тегов типа `{@b text}`, `{@i text}`, `{@link ...}`
- [ ] Решение: сохранить теги как есть или преобразовать
- [ ] Обновить пути к изображениям в JSON (если они меняются)

## 7. Итоговая структура /data_rework/

```
/data_rework/
├── PHB/
│   ├── actions.json
│   ├── backgrounds.json
│   ├── classes.json
│   ├── feats.json
│   ├── items.json
│   ├── spells.json
│   ├── ... (другие JSON)
│   ├── img/
│   │   └── (изображения из PHB)
│   └── pdf/
│       └── (PDF из PHB, если есть)
├── XPHB/
│   ├── actions.json
│   ├── ...
│   ├── img/
│   └── pdf/
├── DMG/
│   ├── ...
│   ├── img/
│   └── pdf/
└── [OTHER_SOURCE]/
    ├── ...
    ├── img/
    └── pdf/
```

## 8. Валидация результата

- [ ] Проверить, что все объекты из исходных JSON распределены по папкам
- [ ] Проверить, что все связанные изображения скопированы
- [ ] Проверить, что все PDF на месте
- [ ] Убедиться, что нет потерянных данных (сумма объектов до = сумма после)